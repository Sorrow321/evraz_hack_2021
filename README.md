# Хакатон Evraz AI 2021. Задача номер 2.

Мое решение состоит из двух нейросетей. Первая нейросеть нужна для детекции людей, а вторая -- для детекции нарушений техники безопасности. 

Пример работы первой нейросети:
<img src="https://sun9-80.userapi.com/impg/ovxt5SkIe33wMLk7Nh6MJtMkx86PSZRtjr9okw/6ddFbobE3gk.jpg?size=1920x1080&quality=96&sign=5a10dd94ff2dc1b62fa4d26d7be53dd1&type=album" alt="drawing" width="800"/>

Пример работы второй нейросети:
<img src="https://sun9-53.userapi.com/impg/0g7Na__mDVfS87cez4A9Slr8dfpKe7_b15c-vA/R3SpXg4lQp8.jpg?size=1920x1080&quality=96&sign=7f77c896eb99ed5e6f617099dac09263&type=album" alt="drawing" width="800"/>

Обе нейросети основаны на популярной архитектуре Yolo V5.

##  Пару слов про формат разметки
Поскольку я использую архитектуру YOLO, а вся разметка дана в формате COCO, то их надо было конвертировать между собой. Для этого у меня есть 2 скрипта в соответствующих директориях: coco_to_yolo и yolo_to_coco. Краткая инструкция по их использованию:
1) coco_to_yolo. Положите .json файл с разметкой в формате COCO в директорию coco_to_yolo (рядом с файлом coco_to_yolo.py), укажите в скрипте coco_to_yolo.py в переменной input_file название вашего .json файла. Запустите скрипт: python coco_to_yolo.py. В директории output_yolo появятся файлы с разметкой в формате YOLO.
2) yolo_to_coco. Положите .txt файлы в формате YOLO в директорию input_yolo. Рядом с ними положите соответствующие им изображения. В скрипте yolo_to_coco.py можете указать имя выходного .json файла в переменной output_file. Запустите скрипт: python yolo_to_coco.py. В директории с coco_to_yolo.py появится выходной .json файл с разметкой в формате COCO.

Стоит указать, что в yolo_to_coco я использовал чужой код из репозитория, указанного в конце данного readme.

## Модель 1.
Основана на Yolo v5 (Large). Входная разметка - от организаторов хакатона. При обучении и инференсе используются изображения с разрешением 1280.  

## Модель 2.
Основана на Yolo v5 (Medium). Входная разметка - от меня лично, размечал руками. При обучении и инференсе используются изображения с разрешением 640.  

## Пару слов про воспроизводимость
Как я понял, в Yolo v5 по дефолту фиксируются все seed'ы. Однако нужно проверить значение переменной окружения RANK в вашей системе:
```bash
printenv | grep RANK
```
Если вам ничего не вывелось (скорей всего будет так), значит у вас этой переменной нет, и все ок. В этом случае мои результаты должны быть воспроизводимы. Если же она у вас есть и не равна -1, то для воспроизводимости вам нужно будет подредактировать код Yolo v5 в файле train.py: строчку 
```python
init_seeds(1 + RANK)
```
надо будет заменить на
```bash
init_seeds(0)
```Это можно сделать, если зайти в контейнер в -it режиме. Однако надеюсь, это не потребуется. Если что, пишите мне, я помогу.

## Ссылки на используемые внешние ресурсы
Архитектура Yolo v5: https://github.com/ultralytics/yolov5. Лицензия: GNU General Public License v3.0 (разрешает коммерческое использование)<br>
Скрипт для перегонки YOLO формата разметки в COCO формат: https://github.com/Taeyoung96/Yolo-to-COCO-format-converter. Лицензия: MIT License (разрешает коммерческое использование)
